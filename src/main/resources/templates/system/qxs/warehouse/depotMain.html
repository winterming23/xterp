<!--
 @program: xterp
 @author: snow
 @create: 2019-12-11 11:54
-->
<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>仓库首页</title>
    <script src="/resources/csss/jquery-1.8.3.min.js"></script>
    <script src="/resources/csss/jquery.dataTables.min.js"></script>

    <script src="/resources/layui/layui.js"></script>
    <link rel="stylesheet" href="/resources/layui/css/layui.css" />
    <link rel="stylesheet" href="/resources/csss/H-ui.min.css" />

    <style>
        #div{
            margin-top: 5%;
        }
    </style>
</head>
<body>
<div id="div" class="layui-tab layui-tab-card" style="height: 730px">
    <ul class="layui-tab-title">
        <li class="layui-this">库房管理</li>
        <li>仓库详情</li>
        <li>出入库管理</li>
    </ul>
    <samp th:text="${errs}"></samp>
    <div class="layui-tab-content">
        <div class="layui-tab-item layui-show">
            <table id="tp" class="table table-border table-bordered table-hover table-bg table-sort">
                <thead>
                <tr class="text-c">
                    <th>物品编号</th>
                    <th>物品名称</th>
                    <th>物品类别</th>
                    <th>基础数量</th>
                    <th>物品单价</th>
                    <th>总额</th>
                    <th>计量单位</th>
                    <th>所在仓库</th>
                    <th>样品图</th>
                    <th>状态</th>
                    <th>操作</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="item:${depotItems}" class="text-c">
                    <td th:text="${item.mid}"></td>
                    <td th:text="${item.mName}"></td>
                    <td th:text="${item.type}"></td>
                    <td th:text="${item.basicNumber}"></td>
                    <td th:text="${item.unitPrice}"></td>
                    <td th:text="${item.allPrice}"></td>
                    <td th:text="${item.mUnit}"></td>
                    <td th:text="${item.dName}"></td>
                    <td>
                        <img th:src="|../static/img/${item.img}|" />
                    </td>
                    <td th:text="${item.flag=='0'?'正常':'已删除'}"></td>
                    <td>
                        <button type="button" th:onclick="file([[${item.id}]])" class="layui-btn layui-btn-sm" id="test1">
                            <i class="layui-icon">&#xe67c;</i>上传图片
                        </button>
                        <div class="layui-btn-group">
                            <button type="button" th:onclick="addMaterials()" class="layui-btn layui-btn-sm">
                                <i class="layui-icon">&#xe654;</i>新增材料类型
                            </button>
                            <button type="button" th:onclick="deleteDepot([[${item.id}]],0)" class="layui-btn layui-btn-sm">
                                <i class="layui-icon">&#xe640;</i>删除
                            </button>
                            <button type="button" class="layui-btn layui-btn-sm">
                                <i class="layui-icon">&#xe602;</i>
                            </button>
                        </div>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
        <div class="layui-tab-item">
            <ul class="layui-timeline">
                <li class="layui-timeline-item" th:each="depot:${depots}">
                    <i class="layui-icon layui-timeline-axis">&#xe63f;</i>
                    <div class="layui-timeline-content layui-text">
                        <h3 class="layui-timeline-title">[[${depot.name}]]</h3>
                        <table class="layui-table">
                            <thead>
                                <tr>
                                    <th>仓库编号</th>
                                    <th>仓库地址</th>
                                    <th>仓库类型</th>
                                    <th>仓库负责人</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td th:text="${depot.id}"></td>
                                    <td th:text="${depot.address}"></td>
                                    <td th:text="${depot.type}"></td>
                                    <td th:text="${depot.principal}"></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </li>
            </ul>
        </div>
        <div class="layui-tab-item">
            <!-- 出入库管理 -->
            <ul class="layui-timeline">
                <li class="layui-timeline-item" th:each="head:${depotHeads}">
                    <i class="layui-icon layui-timeline-axis">&#xe63f;</i>
                    <div class="layui-timeline-content layui-text">
                        <h3 class="layui-timeline-title">[[${head.operTime}]]</h3>
                        <p>
                            layui 2.0 的一切准备工作似乎都已到位。发布之弦，一触即发。
                            <br>不枉近百个日日夜夜与之为伴。因小而大，因弱而强。
                            <br>无论它能走多远，抑或如何支撑？至少我曾倾注全心，无怨无悔 <i class="layui-icon"></i>
                        </p>
                    </div>
                </li>
            </ul>
        </div>
    </div>
</div>

</body>
<script type="text/javascript">
    //注意：选项卡 依赖 element 模块，否则无法进行功能性操作
    layui.use('element', function(){
        var element = layui.element;
    });

    $("#tp").DataTable({
        aLengthMenu:[3,5,10]
    });
    // layui文件上传
    /*layui.form.on('select(typeFilter)',function (data) {
        if(data.value==1){
            //控制第一个页面展示代码
            //给按钮加layui.upload.render()代码 即上述代码
            layui.use('upload', function(){
                var upload = layui.upload;
                var uploadInst = upload.replace({
                    elem:'file',//绑定元素
                    url:'',//上传路径
                    done:function (resp) {
                        //上传回调

                    },error:function () {
                        //请求异常回调
                    }
                });
            });
        }
    })*/

    //文件上传
    function file(id) {
        layui.use('layer',function () {
            var layer = layui.layer;
            var dom = "<div><form class='layui-form' enctype='multipart/form-data' method='post' action='/depot/itemFile'>" +
                "<input type='hidden' name='id' value='"+id+"'/> <br/> " +
                "<div class='layui-btn-container'><input type='file' name='file' /></div> <br/> " +
                "<input type='submit' class='layui-btn' name='提交' />" +
                "</form></div>";
            layer.open({
                title:'上传样图',
                type:1,
                skin: 'layui-layer-lan ', //样式类名
                closeBtn: 1, //显示关闭按钮
                anim: 2,
                area:['30%','30%'],
                resize:true,
                //id: '1', //防止重复弹出
                shadeClose: true, //开启遮罩关闭
                shade:[0.5], //透明度，背景颜色
                content: dom,
                btn:['取消']
            })
        })
    }

    //删除数据
    function deleteDepot(id,a) {
        if(confirm('是否确定删除')){
            if(a==0){
                $.ajax({
                    url:'/depot/deleteItem',
                    dateType:'json',
                    type:'post',
                    data:{'id':id},
                    success:function (resp) {
                        if(resp){
                            alert('数据已删除');
                            prototype.location.reload();
                            location.href='/depot/pageDepot';
                        }else {
                            alert('数据删除失败...')
                        }
                    }
                });
            }
        }
    }

    //新增材料类别
    function addMaterials() {
        layui.use('layer',function () {
            var layer = layui.layer;
            var dom = "<div><table class='layui-table'><thead>" +
                "<tr class='text-c'>" +
                "<th>名称</th>" +
                "<th>类型</th>" +
                "<th>计量单位</th>" +
                "<th>描述</th>" +
                "</tr></thead>" +
                "<tbody><tr class='text-c'>" +
                "<td><input type='text' name='mName' placeholder='请输入名称' required class='layui-input' autocomplete='off' /></td>" +
                "<td><input type='radio' name='mType' required lay-skin='primary' autocomplete='off' value='成品' />成品  " +
                "<input type='radio' name='mType' required lay-skin='primary' autocomplete='off' value='零件' checked />零件</td>" +
                "<td><input name='mUnit' placeholder='请输入计量单位' type='text' required class='layui-input' autocomplete='off' /></td>" +
                "<td><textarea name='remark' required class='layui-textarea' placeholder='请输入'></textarea></td>" +
                "</tr></tbody>" +
                "</table></div>"
            layer.open({
                title:'新增材料类别',
                type:1,
                skin: 'layui-layer-lan ', //样式类名
                closeBtn: 1, //显示关闭按钮
                anim: 2,
                area:['60%','35%'],
                resize:true,
                //id: '1', //防止重复弹出
                shadeClose: true, //开启遮罩关闭
                shade:[0.5], //透明度，背景颜色
                content: dom,
                btn:['确定','取消'],
                yes:function () {
                    var mName = $("input[name='mName']").val();
                    var mType = $("input[name='mType']:checked").val();
                    var mUnit = $("input[name='mUnit']").val();
                    var remark = $("textarea[name='remark']").val();
                    //alert(mName+"=="+mType);
                    alert(mName+"="+mType+"="+mUnit+"="+remark)
                    if(mName!=null && mName!="" && mUnit!=null && mUnit!="" && remark!=null && remark!=""){
                        $.ajax({
                           url:'/depot/addMaterials',
                           dateType:'json',
                           type:'post',
                           data:{'mName':mName,'mType':mType,'mUnit':mUnit,'remark':remark},
                           success:function (resp) {
                               if(resp){
                                   debugger;
                                   alert('数据添加成功...');
                                   location.reload();
                                   location.href='/depot/pageDepot';
                               }else {
                                   alert('数据添加失败...')
                               }
                           }
                        });
                    }else {
                        alert("请填写数据");
                    }
                }
            })
        })
    }
</script>
</html>